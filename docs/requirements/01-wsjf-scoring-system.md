# WSJF 评分系统需求文档

---

## 需求概述

### 功能名称
WSJF (Weighted Shortest Job First) 加权评分系统

### 业务价值
- 帮助团队科学地进行需求优先级排序
- 平衡业务价值、时间紧迫性、技术复杂度和工作量
- 提供可视化的权重分和星级评定

### 目标用户
- 产品经理：评估需求业务价值
- 研发负责人：评估技术复杂度和工作量
- 团队Leader：进行需求优先级决策

### 优先级
🔴 **P0 - 核心功能**

---

## 功能描述

### 核心功能

WSJF 评分系统根据以下4个维度计算需求的优先级权重分：

1. **业务影响度** (Business Impact) - 1-10分
2. **技术复杂度** (Complexity) - 1-10分
3. **时间窗口** (Time Criticality) - 随时/三月窗口/一月硬窗口
4. **工作量** (Effort) - 预估人天数

### 用户故事

**作为** 产品经理
**我想要** 对需求进行业务影响度评分
**以便** 团队了解需求的业务价值

**作为** 研发负责人
**我想要** 对需求进行技术复杂度评分
**以便** 团队了解技术实现难度

**作为** 团队Leader
**我想要** 看到自动计算的权重分和星级
**以便** 快速识别高优先级需求

### 使用场景

**场景1：新需求评估**
1. 产品经理新建需求
2. 填写业务影响度（1-10分）
3. 研发负责人填写技术复杂度（1-10分）和工作量（人天）
4. 选择时间窗口，是否有强制DDL
5. 系统自动计算权重分（1-100）和星级（2-5星）
6. 需求自动按权重分排序

**场景2：需求对比**
1. 查看待排期需求列表
2. 需求按权重分降序排列
3. 高权重分（≥85）显示5星，醒目标识
4. 快速识别"强窗口/立即投入"的需求

**场景3：评分调整**
1. 需求评估后发现业务价值被低估
2. 修改业务影响度分数
3. 系统重新计算所有需求的权重分（归一化）
4. 排序自动更新

---

## 详细需求

### 功能点列表

#### 1. 业务影响度评分（1-10分）

**分数定义：**

| 分数 | 级别 | 典型场景 |
|------|------|---------|
| 10 | 致命缺陷 | 系统崩溃、核心功能失效 |
| 9 | 严重阻塞 | 关键业务流程阻塞 |
| 8 | 战略必需 | CEO级项目、战略转型 |
| 7 | 显著影响 | 影响多个核心指标 |
| 6 | 战略加速 | 加速业务增长 |
| 5 | 重要优化 | 改善过程指标 |
| 4 | 有价值优化 | 小幅体验提升 |
| 3 | 常规功能 | 常规需求 |
| 2 | 小幅改进 | 锦上添花 |
| 1 | Nice-to-have | 可有可无 |

**UI交互：**
- 下拉选择器，展示分数+级别名称
- 悬停显示详细说明
- 必填字段，默认值5分

#### 2. 技术复杂度评分（1-10分）

**分数定义：**

| 分数 | 级别 | 技术挑战 |
|------|------|---------|
| 10 | 全新技术平台 | 全新技术栈、架构重建 |
| 9 | 核心架构重构 | 核心系统重构 |
| 8 | 系统级改造 | 多系统集成、底层改造 |
| 7 | 复杂功能开发 | 复杂算法、高并发 |
| 6 | 跨系统集成 | 多系统对接 |
| 5 | 标准功能开发 | 常规CRUD+业务逻辑 |
| 4 | 简单集成 | 第三方SDK集成 |
| 3 | 页面开发 | 纯前端页面 |
| 2 | 配置调整 | 参数配置 |
| 1 | 简单修改 | 文案、样式调整 |

**UI交互：**
- 下拉选择器，展示分数+级别名称
- 悬停显示详细说明
- 可选字段，默认值5分

#### 3. 时间窗口

**选项定义：**
- **随时** - 没有明确时间要求，可灵活安排
- **三月窗口** - 有一定时间要求，但可在3个月内完成
- **一月硬窗口** - 时间紧迫，必须在1个月内完成

**分数映射：**
- 随时: 0分
- 三月窗口: 3分
- 一月硬窗口: 5分

**UI交互：**
- 单选按钮组
- 默认值："随时"

#### 4. 强制DDL（截止日期）

**定义：**
- 是否存在硬性截止日期（如法规要求、合同约定、大促节点）
- 有强制DDL +5分

**UI交互：**
- 复选框："是否有强制DDL"
- 如勾选，显示日期选择器
- 日期以红色醒目显示

#### 5. 工作量评估

**定义：**
- 预估完成该需求所需的人天数
- 用于计算工作量奖励分（鼓励优先完成小任务）

**工作量奖励规则（8档细分）：**
- ≤2天: +8分（极小任务，最高奖励）
- 3-5天: +7分（小任务，高优先级）
- 6-14天: +5分（常规任务，正常推进）
- 15-30天: +3分（中等任务，需要规划）
- 31-50天: +2分（大任务，建议切分）
- 51-100天: +1分（超大任务，必须切分）
- 101-150天: 0分（巨型任务，严重超标）
- >150天: 0分（不可接受，禁止入池）

**UI交互：**
- 数字输入框
- 单位：天
- 必填字段

---

### 业务规则

#### 权重分计算规则

**第一步：计算原始分（rawScore）**

```
rawScore = businessImpactScore + complexityFactor + timeFactor + effortBonus

其中：
- businessImpactScore = 业务影响度（1-10）
- complexityFactor = (11 - 技术复杂度) × 0.5  【复杂度越高，优先级越低】
- timeFactor = 时间窗口分数 + DDL分数
- effortBonus = 工作量奖励分
```

**设计理念：**
1. **业务影响度**：直接加分，影响越大优先级越高
2. **技术复杂度**：反向计算，复杂度越高优先级越低（鼓励优先完成简单高价值需求）
3. **时间因子**：时间越紧迫，优先级越高
4. **工作量奖励**：小任务加分，鼓励快速交付

**第二步：归一化到1-100（displayScore）**

```
displayScore = 10 + 90 × (rawScore - minRaw) / (maxRaw - minRaw)
```

**特殊情况：**
- 当所有需求原始分相同时，统一设为60分
- 确保分数在1-100区间内

**第三步：星级分档**

```
displayScore >= 85: ★★★★★ (5星) - 强窗口/立即投入
displayScore >= 70: ★★★★ (4星) - 优先执行
displayScore >= 55: ★★★ (3星) - 普通计划项
displayScore < 55:  ★★ (2星) - 择机安排
```

#### 自动重算规则

**触发条件（任一）：**
- 新增需求
- 修改任意需求的评分维度
- 删除需求

**重算逻辑：**
1. 重新计算所有需求的 rawScore
2. 基于新的 min/max 重新归一化
3. 更新所有 displayScore 和 stars
4. 重新排序

---

### 数据模型

```typescript
interface Requirement {
  // 业务影响度评分
  businessImpactScore?: BusinessImpactScore;  // 1-10

  // 技术复杂度评分
  complexityScore?: ComplexityScore;  // 1-10

  // 工作量
  effortDays: number;  // 人天数

  // 时间窗口
  timeCriticality?: '随时' | '三月窗口' | '一月硬窗口';

  // 强制DDL
  hardDeadline: boolean;
  deadlineDate?: string;  // YYYY-MM-DD

  // 计算结果（系统自动）
  rawScore?: number;      // 原始分（3-28范围）
  displayScore?: number;  // 权重分（1-100）
  stars?: number;         // 星级（2-5）
}
```

---

## 交互设计

### 界面布局

**需求卡片显示：**

```
┌─────────────────────────────────────────────────┐
│ 【需求名称】权重 85 ★★★★★ [新零售]           │
│ 提交人: 张三 • 产品经理: 李四 • 研发: 王五   │
│ ┌─────────────────────────────────────────────┐ │
│ │ 业务影响度: 8/10  技术复杂度: 6/10  15天  │ │
│ │ 时间窗口: 三月窗口  强制DDL: 2024-03-31   │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

**编辑界面：**

```
┌──────────── 编辑需求 ────────────┐
│                                    │
│ 业务影响度评分 (1-10分) *          │
│ [8 - 战略必需 ▼]                 │
│ 💡 公司战略级项目，影响多个核心指标│
│                                    │
│ 技术复杂度评分 (1-10分)            │
│ [6 - 跨系统集成 ▼]               │
│ 💡 需要对接2-3个外部系统           │
│                                    │
│ 预估工作量 *                       │
│ [15] 天                            │
│                                    │
│ 时间窗口 *                         │
│ ◯ 随时  ◉ 三月窗口  ◯ 一月硬窗口 │
│                                    │
│ ☑ 有强制DDL  [2024-03-31]        │
│                                    │
│ ─────────────────────────────────│
│ 📊 实时预览                       │
│ 权重分: 85  星级: ★★★★★          │
│ ─────────────────────────────────│
│                                    │
│        [取消]  [保存]             │
└────────────────────────────────────┘
```

### 交互流程

**流程1：新增需求并评分**

```
点击"新增需求"
  ↓
填写基本信息（名称、提交人等）
  ↓
选择业务影响度（1-10分） ← 必填
  ↓
选择技术复杂度（1-10分） ← 可选，默认5
  ↓
填写预估工作量（天） ← 必填
  ↓
选择时间窗口 ← 必填，默认"随时"
  ↓
【可选】勾选"强制DDL"并选择日期
  ↓
实时预览：显示计算后的权重分和星级
  ↓
点击"保存"
  ↓
系统重新计算所有需求的权重分
  ↓
需求列表自动按权重分排序
```

**流程2：修改评分**

```
点击需求卡片"编辑"按钮
  ↓
显示编辑弹窗，加载当前评分
  ↓
修改评分维度
  ↓
实时预览更新（显示新的权重分和星级）
  ↓
点击"保存"
  ↓
系统重新计算所有需求的权重分（因为归一化）
  ↓
需求列表自动重新排序
```

---

## 技术实现

### 关键代码位置

**文件：** `src/wsjf-sprint-planner.tsx`

**核心函数：**

```typescript
// 权重分计算
const calculateScores = (requirements: Requirement[]): Requirement[] => {
  // 1. 计算所有需求的 rawScore
  const withRawScores = requirements.map(req => {
    const businessImpact = req.businessImpactScore || 5;
    const complexityFactor = req.complexityScore
      ? (11 - req.complexityScore) * 0.5
      : 3;

    const tc = req.timeCriticality || req.tc || '随时';
    const timeScore = TIME_CRITICALITY_MAP[tc] || 0;
    const ddlScore = req.hardDeadline ? 5 : 0;

    const effortBonus = getWorkloadScore(req.effortDays);

    const rawScore = businessImpact + complexityFactor +
                     timeScore + ddlScore + effortBonus;

    return { ...req, rawScore };
  });

  // 2. 归一化
  const rawScores = withRawScores.map(r => r.rawScore!);
  const minRaw = Math.min(...rawScores);
  const maxRaw = Math.max(...rawScores);

  const withScores = withRawScores.map(req => {
    let displayScore;
    if (maxRaw === minRaw) {
      displayScore = 60;
    } else {
      displayScore = 10 + 90 * (req.rawScore! - minRaw) / (maxRaw - minRaw);
    }

    // 3. 星级
    let stars;
    if (displayScore >= 85) stars = 5;
    else if (displayScore >= 70) stars = 4;
    else if (displayScore >= 55) stars = 3;
    else stars = 2;

    return { ...req, displayScore, stars };
  });

  return withScores;
};
```

**常量配置：**

文件：`src/constants/scoring-rules.ts`

---

## 验收标准

### 功能验收

- [ ] 业务影响度：可选择1-10分，展示对应级别名称
- [ ] 技术复杂度：可选择1-10分，展示对应级别名称
- [ ] 工作量：可输入正整数
- [ ] 时间窗口：可选择三个选项
- [ ] 强制DDL：可勾选并选择日期
- [ ] 权重分：自动计算，范围1-100
- [ ] 星级：自动计算，2-5星
- [ ] 排序：需求自动按权重分降序排列
- [ ] 重算：修改任意需求后，所有需求权重分重新计算

### 计算准确性

**测试用例1：基础计算**
```
输入：
- 业务影响度: 8
- 技术复杂度: 6
- 工作量: 15天
- 时间窗口: 三月窗口
- 强制DDL: 无

预期：
- rawScore = 8 + (11-6)*0.5 + 3 + 0 + 3 = 16.5
  （工作量15天属于15-30天档，奖励+3分）
- displayScore ≈ 归一化后的值
- stars = 根据 displayScore 分档
```

**测试用例2：极端值**
```
输入：
- 业务影响度: 10
- 技术复杂度: 1
- 工作量: 3天
- 时间窗口: 一月硬窗口
- 强制DDL: 是

预期：
- rawScore = 10 + (11-1)*0.5 + 5 + 5 + 7 = 32
  （工作量3天属于3-5天档，奖励+7分）
- 应为所有需求中最高分
```

### 性能要求

- 需求数量 < 100：评分计算 < 100ms
- 需求数量 < 1000：评分计算 < 500ms

### 兼容性

- 支持 Chrome/Edge 最新版本
- 支持 Firefox 最新版本
- 支持 Safari 14+

---

## 变更历史

### v1.3.0 (2025-01-19)
- ✅ 将4档BV评分升级为10分制业务影响度
- ✅ 新增10分制技术复杂度评分
- ✅ 优化权重分计算算法（引入复杂度因子）

### v1.2.0 (2024-12-XX)
- ✅ 10分制业务影响度评分系统上线

### v1.0.0 (2024-10-17)
- ✅ 初始版本，WSJF-Lite评分系统

---

**维护者**: 产品团队
**最后更新**: 2025-01-19
**版本**: v1.3
