# é£ä¹¦ MCP é›†æˆå®Œæ•´é…ç½®æŒ‡å—

## ğŸ¯ æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      HTTP       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      MCP       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµè§ˆå™¨åº”ç”¨      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚  Node.js ä»£ç†     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚ mcp-feishu- â”‚
â”‚  (React)        â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  (Express)       â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    proj     â”‚
â”‚  :5173         â”‚                 â”‚  :3001           â”‚               â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†ï¼Ÿ**
- æµè§ˆå™¨æ— æ³•ç›´æ¥è°ƒç”¨ MCP å·¥å…·ï¼ˆå®‰å…¨é™åˆ¶ï¼‰
- Node.js åç«¯å¯ä»¥è°ƒç”¨ MCP å¹¶é€šè¿‡ HTTP API æš´éœ²ç»™å‰ç«¯

## ğŸ“‹ å®Œæ•´é…ç½®æ­¥éª¤

### ç¬¬ 1 æ­¥ï¼šå®‰è£…åç«¯ä¾èµ–

```bash
cd d:\code\WSJF\server
npm install
```

### ç¬¬ 2 æ­¥ï¼šå¯åŠ¨åç«¯ä»£ç†æœåŠ¡å™¨

**æ–¹å¼ Aï¼šå•ç‹¬å¯åŠ¨**
```bash
npm run server
```

**æ–¹å¼ Bï¼šåŒæ—¶å¯åŠ¨å‰åç«¯ï¼ˆæ¨èï¼‰**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
npm install concurrently --save-dev
npm run dev:all
```

### ç¬¬ 3 æ­¥ï¼šéªŒè¯åç«¯æœåŠ¡

è®¿é—® http://localhost:3001/api/health

åº”è¯¥çœ‹åˆ°ï¼š
```json
{
  "status": "ok",
  "mcp_configured": true,
  "timestamp": "2025-01-..."
}
```

### ç¬¬ 4 æ­¥ï¼šå¯åŠ¨å‰ç«¯åº”ç”¨

```bash
npm run dev
```

è®¿é—® http://localhost:5173

### ç¬¬ 5 æ­¥ï¼šæµ‹è¯•é£ä¹¦å¯¼å…¥

1. ç‚¹å‡»"ä»é£ä¹¦å¯¼å…¥"æŒ‰é’®
2. é…ç½®æŸ¥è¯¢é€‰é¡¹
3. ç‚¹å‡»"å¼€å§‹æŸ¥è¯¢"
4. åº”è¯¥çœ‹åˆ°ä»é£ä¹¦é¡¹ç›®è·å–çš„çœŸå®æ•°æ®

## âš™ï¸ MCP å·¥å…·åç§°é…ç½®

**é‡è¦**ï¼šéœ€è¦æ ¹æ® `mcp-feishu-proj` çš„å®é™… API è°ƒæ•´å·¥å…·åç§°ã€‚

åœ¨ `server/feishu-mcp-proxy.js` ä¸­æ‰¾åˆ°ï¼š

```javascript
const result = await callMCPTool('feishu_proj_query_work_items', {
  // ...å‚æ•°
});
```

**å¦‚ä½•æŸ¥çœ‹å¯ç”¨çš„ MCP å·¥å…·**ï¼š

1. åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š
```bash
mcp-feishu-proj --help
```

2. æˆ–æŸ¥çœ‹ mcp-feishu-proj çš„æ–‡æ¡£è·å–æ­£ç¡®çš„å·¥å…·åç§°

3. å¸¸è§çš„å·¥å…·åç§°å¯èƒ½æ˜¯ï¼š
   - `query_work_items`
   - `list_stories`
   - `get_project_items`

æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ `callMCPTool` çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

åç«¯ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼ˆå·²ç¡¬ç¼–ç åœ¨ `feishu-mcp-proxy.js` ä¸­ï¼‰ï¼š

```javascript
const MCP_CONFIG = {
  command: 'C:\\Users\\Evan Tian\\AppData\\Roaming\\Python\\Python312\\Scripts\\mcp-feishu-proj.exe',
  env: {
    FS_PROJ_BASE_URL: 'https://project.f.mioffice.cn/',
    FS_PROJ_PROJECT_KEY: '632d4f29aa4481312c2ab170',
    FS_PROJ_USER_KEY: '7541721806923694188',
    FS_PROJ_PLUGIN_ID: 'MII_68F1064FA240006C',
    FS_PROJ_PLUGIN_SECRET: '050E0E049ACB87339CB9D11E5641564F',
  }
};
```

**ä¿®æ”¹é…ç½®**ï¼šç›´æ¥ç¼–è¾‘ `server/feishu-mcp-proxy.js` æ–‡ä»¶ä¸­çš„ `MCP_CONFIG` å¯¹è±¡ã€‚

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šåç«¯æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**ï¼š`npm run server` æŠ¥é”™

**æ£€æŸ¥**ï¼š
1. ç¡®è®¤ Node.js å·²å®‰è£…ï¼ˆ`node --version`ï¼‰
2. ç¡®è®¤ä¾èµ–å·²å®‰è£…ï¼ˆ`cd server && npm install`ï¼‰
3. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 2ï¼šMCP è°ƒç”¨å¤±è´¥

**ç—‡çŠ¶**ï¼šå‰ç«¯æç¤º"æŸ¥è¯¢å¤±è´¥"

**æ£€æŸ¥**ï¼š
1. åç«¯æ—¥å¿—ä¸­æ˜¯å¦æœ‰ MCP é”™è¯¯
2. MCP å·¥å…·åç§°æ˜¯å¦æ­£ç¡®
3. é£ä¹¦å‡­è¯æ˜¯å¦æœ‰æ•ˆ

**è°ƒè¯•**ï¼š
```bash
# ç›´æ¥æµ‹è¯• MCP å·¥å…·
mcp-feishu-proj --transport stdio
# ç„¶åè¾“å…¥ MCP åè®®è¯·æ±‚
```

### é—®é¢˜ 3ï¼šCORS é”™è¯¯

**ç—‡çŠ¶**ï¼šæµè§ˆå™¨æ§åˆ¶å°æç¤º CORS é”™è¯¯

**è§£å†³**ï¼šæ£€æŸ¥ `server/feishu-mcp-proxy.js` ä¸­æ˜¯å¦æœ‰ï¼š
```javascript
app.use(cors());
```

### é—®é¢˜ 4ï¼šè¿æ¥è¢«æ‹’ç»

**ç—‡çŠ¶**ï¼š"æ— æ³•è¿æ¥åˆ° MCP ä»£ç†æœåŠ¡å™¨"

**æ£€æŸ¥**ï¼š
1. åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼ˆè®¿é—® http://localhost:3001/api/healthï¼‰
2. ç«¯å£ 3001 æ˜¯å¦è¢«å ç”¨
3. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢è¿æ¥

## ğŸ“Š API ç«¯ç‚¹è¯´æ˜

### POST /api/feishu/query-stories

æŸ¥è¯¢é£ä¹¦å·¥ä½œé¡¹

**è¯·æ±‚ä½“**ï¼š
```json
{
  "status": ["å¼€å‘ä¸­"],
  "priority": ["é«˜"],
  "limit": 50,
  "offset": 0
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": "FS-001",
      "name": "éœ€æ±‚åç§°",
      "status": "å¼€å‘ä¸­",
      ...
    }
  ],
  "total": 100
}
```

### POST /api/feishu/sync-updates

å¢é‡åŒæ­¥

**è¯·æ±‚ä½“**ï¼š
```json
{
  "lastSyncTime": "2025-01-17T10:00:00Z"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": [...]
}
```

## ğŸš€ ç”Ÿäº§éƒ¨ç½²

### æ–¹å¼ 1ï¼šæœ¬åœ°éƒ¨ç½²

1. åç«¯å’Œå‰ç«¯åˆ†åˆ«å¯åŠ¨
2. ä½¿ç”¨ PM2 ç®¡ç†åç«¯è¿›ç¨‹ï¼š
```bash
npm install -g pm2
pm2 start server/feishu-mcp-proxy.js --name feishu-mcp-proxy
```

### æ–¹å¼ 2ï¼šæ‰“åŒ…ä¸º Electron åº”ç”¨

åœ¨ Electron ç¯å¢ƒä¸­å¯ä»¥ç›´æ¥è°ƒç”¨ MCPï¼Œæ— éœ€åç«¯ä»£ç†ã€‚

### æ–¹å¼ 3ï¼šDocker éƒ¨ç½²

åˆ›å»º `docker-compose.yml`ï¼š
```yaml
version: '3'
services:
  frontend:
    build: .
    ports:
      - "5173:5173"
  backend:
    build: ./server
    ports:
      - "3001:3001"
    environment:
      - FS_PROJ_BASE_URL=...
```

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] åç«¯æœåŠ¡æ­£å¸¸å¯åŠ¨ï¼ˆhttp://localhost:3001/api/health è¿”å› okï¼‰
- [ ] MCP å·¥å…·åç§°æ­£ç¡®
- [ ] é£ä¹¦å‡­è¯æœ‰æ•ˆ
- [ ] å‰ç«¯å¯ä»¥æˆåŠŸæŸ¥è¯¢æ•°æ®
- [ ] å­—æ®µæ˜ å°„æ­£ç¡®
- [ ] é”™è¯¯æç¤ºå‹å¥½

---

**ğŸ‰ é…ç½®å®Œæˆï¼**ç°åœ¨ä½ å¯ä»¥ç›´æ¥ä»é£ä¹¦é¡¹ç›®å¯¼å…¥çœŸå®æ•°æ®äº†ï¼
