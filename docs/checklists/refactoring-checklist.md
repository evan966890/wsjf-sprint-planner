# 重构检查清单

> ⚠️ **强制执行**: 所有重构工作必须完成此清单才能提交

---

## 📋 重构前准备（Pre-Refactoring）

### 1. 记录当前状态
- [ ] 记录文件当前行数：`wc -l <file>`
- [ ] 运行 `git status` 确保工作区干净
- [ ] 创建专用分支：`git checkout -b refactor/<component-name>`

### 2. 保存原始界面（如果是UI组件）
- [ ] 截图所有UI状态（默认、hover、激活、错误等）
- [ ] 保存到 `docs/screenshots/before-refactor/`
- [ ] 记录所有交互流程

### 3. 分析代码结构
- [ ] 列出所有重要属性（如 `type`, `className`, `data-*`）
- [ ] 记录 section 划分逻辑
- [ ] 记录字段分组和位置
- [ ] 提取关键代码片段保存为参考

### 4. 创建测试清单
- [ ] 列出所有需要测试的功能点
- [ ] 列出所有需要验证的UI状态
- [ ] 列出所有边界情况

---

## 🔨 重构中执行（During Refactoring）

### 1. 渐进式重构
- [ ] 每次只重构一个小模块
- [ ] 每完成一个模块，立即验证
- [ ] 频繁提交：`git add . && git commit -m "refactor: <module>"`

### 2. 保持属性完整
- [ ] ✅ **关键**: 所有 `<button>` 必须保留 `type="button"`
- [ ] 检查所有 HTML 属性（id, className, data-*）
- [ ] 检查所有事件处理器（onClick, onChange, onSubmit）
- [ ] 检查所有条件渲染逻辑

### 3. 定期对比
```bash
# 每完成一个 section，运行此命令
git diff

# 检查是否删除了重要属性
git diff | grep -E "^\-.*type=\"button\""

# 如果有输出，立即修复！
```

### 4. 保持结构一致
- [ ] section 划分逻辑不变
- [ ] 字段分组不变
- [ ] 渲染顺序不变
- [ ] 样式类名保持一致

---

## ✅ 重构后验证（Post-Refactoring）

### 1. Git Diff 全面检查 ⭐⭐⭐

```bash
# 1. 查看完整差异
git diff main

# 2. 检查删除的 type 属性
git diff main | grep -E "^\-.*type=\"button\"" | wc -l
# 输出应该是 0，否则必须修复

# 3. 检查删除的其他重要属性
git diff main | grep -E "^\-.*className=|^\-.*id=|^\-.*data-" | wc -l
# 输出应该与新增的数量相当

# 4. 统计删除和新增行数
git diff --stat
```

### 2. ESLint 和 TypeScript 检查 ⭐⭐⭐

```bash
# TypeScript 类型检查
npx tsc --noEmit

# ESLint 检查
npm run lint

# 生产构建
npm run build
```

### 3. 功能测试 ⭐⭐⭐

**UI 交互测试**:
- [ ] 所有按钮可点击
- [ ] 不会触发页面刷新
- [ ] 不会触发下载文件
- [ ] 弹窗正常打开/关闭
- [ ] 表单提交正常
- [ ] 所有输入框可编辑
- [ ] 所有下拉框可选择
- [ ] 所有复选框可勾选

**核心功能测试**:
- [ ] 新建功能
- [ ] 编辑功能
- [ ] 删除功能
- [ ] 保存功能
- [ ] 取消功能
- [ ] 数据持久化

**边界情况测试**:
- [ ] 空值处理
- [ ] 长文本处理
- [ ] 特殊字符处理
- [ ] 错误提示

### 4. UI 对比验证 ⭐⭐

- [ ] 对比重构前后截图
- [ ] 所有字段位置正确
- [ ] Section 划分符合原设计
- [ ] 样式无异常
- [ ] 间距、对齐正确

### 5. 代码质量检查 ⭐

```bash
# 文件行数检查
wc -l <file>

# 是否符合 500 行限制
npm run check-file-size

# 是否有遗留的 console.log
grep -r "console.log" src/
```

---

## 📊 重构质量自评

### 评分标准

| 项目 | 权重 | 自评分 (1-5) | 备注 |
|------|------|-------------|------|
| 功能完整性 | 40% | [ ] | 所有功能正常 = 5分 |
| 代码简洁性 | 20% | [ ] | 行数减少 > 30% = 5分 |
| 测试覆盖率 | 20% | [ ] | 100%测试通过 = 5分 |
| 文档完整性 | 10% | [ ] | 有完整文档 = 5分 |
| 可维护性 | 10% | [ ] | 逻辑清晰易读 = 5分 |
| **总分** | 100% | [ ] | ≥ 4.0 才能提交 |

**计算公式**:
```
总分 = (功能完整性×0.4) + (代码简洁性×0.2) + (测试覆盖率×0.2)
     + (文档完整性×0.1) + (可维护性×0.1)
```

**提交标准**:
- ✅ 总分 ≥ 4.0 - 可以提交
- ⚠️ 总分 3.0-3.9 - 需要改进
- ❌ 总分 < 3.0 - 不能提交，必须修复

---

## 🚨 常见错误检查清单

### 必查项（曾经出现过的bug）

- [ ] ✅ 所有 `<button>` 都有 `type="button"` 属性
- [ ] ✅ "产品进展"和"技术进展"在"技术评估" section
- [ ] ✅ 所有字段分组逻辑正确
- [ ] ✅ 没有删除重要的事件处理器
- [ ] ✅ 没有删除条件渲染逻辑
- [ ] ✅ 没有改变字段的默认值
- [ ] ✅ 没有改变字段的验证逻辑

### 快速检查命令

```bash
# 检查按钮 type 属性
grep -r "<button" src/ | grep -v "type=\"button\"" | grep -v "type=\"submit\""

# 应该只返回很少的结果（如果有的话）

# 检查是否有未处理的 TODO
grep -r "TODO\|FIXME\|XXX" src/

# 检查是否有调试代码
grep -r "console\." src/
```

---

## 📝 提交前最后检查

### 1. Git 提交信息

```bash
# 提交信息格式
git commit -m "refactor: <component> (行数变化: XXX → YYY, -ZZ%)"

# 示例
git commit -m "refactor: EditRequirementModal (2229 → 442行, -80%)"
```

### 2. PR 描述模板

```markdown
## 重构说明

**重构文件**: `src/components/XXX.tsx`
**行数变化**: 2229 → 442行 (-80%)

## 重构目标
- [ ] 减少文件大小
- [ ] 提取复用逻辑
- [ ] 提高可维护性

## 功能验证
- [x] 所有功能测试通过
- [x] UI 对比无差异
- [x] TypeScript 编译通过
- [x] 生产构建成功

## 测试截图
[附上测试截图]

## 自评分
- 功能完整性: 5/5
- 代码简洁性: 5/5
- 测试覆盖率: 4/5
- **总分**: 4.6/5 ✅
```

---

## 🎯 重构完成标准

**只有满足以下所有条件，才算重构完成**:

✅ 所有检查清单项目都勾选
✅ 所有测试通过
✅ 自评分 ≥ 4.0
✅ 代码审查通过
✅ 无未解决的 TODO
✅ 文档已更新

---

**记住**: 重构的目标是**提高代码质量**，而不是单纯减少行数。功能完整性永远是第一位的！
