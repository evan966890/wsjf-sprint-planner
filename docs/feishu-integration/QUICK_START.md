# 飞书集成快速开始指南

## 🎯 您的情况

- ✅ 您有飞书开放平台的应用（WSJF-Lite）
- ✅ Plugin ID: `MII_68F1064FA240006C`
- ✅ Plugin Secret: `050E0E049ACB87339CB9D11E5641564F`
- ❌ 您没有管理员权限安装应用到整个租户
- ✅ 您想读取**您个人有权限的飞书项目**

**好消息**: 我已经实现了**用户授权模式**，您无需管理员权限即可使用！

---

## ⚡ 3步快速配置（5分钟）

### 第1步: 在飞书开放平台配置OAuth回调地址

1. **打开飞书开放平台** https://open.feishu.cn
2. **进入您的应用"WSJF-Lite"**
3. **在左侧菜单找到这些位置之一**：
   - "安全设置" 或
   - "网页" 或
   - "开发配置" 或
   - "OAuth设置"

4. **找到"重定向URL"或"Redirect URLs"配置**

5. **添加以下地址**：
   ```
   http://localhost:3000/feishu-callback
   ```

6. **点击"保存"**

### 第2步: 确认权限配置

在"权限管理"页面，确保已添加：

- ✅ **查看项目信息** (`project:project:readonly`)
- ✅ **查看工作项信息** (`project:work_item:readonly`)
- ✅ **获取用户信息** (`contact:user.base:readonly`) ← 用户授权需要

### 第3步: 发布新版本

1. 进入"版本管理与发布"
2. 点击"创建版本"
3. 版本说明：添加OAuth回调地址
4. 点击"申请发布"

---

## 🚀 开始使用（超简单！）

配置完成后，使用流程：

### 1. 打开WSJF应用
```bash
# 如果服务器未运行
cd WSJF
npm run dev
```

打开浏览器访问 http://localhost:3000

### 2. 点击"从飞书导入"

在Header找到紫色的"从飞书导入"按钮，点击它

### 3. 填写应用信息

在弹出的窗口中：
- **Plugin ID**: `MII_68F1064FA240006C`
- **Plugin Secret**: `050E0E049ACB87339CB9D11E5641564F`

### 4. 点击"开始授权"

- 会自动跳转到飞书授权页面
- **在飞书页面点击"同意授权"**
- 自动返回WSJF应用

### 5. 选择项目和任务

- 现在能看到您的飞书项目列表了！
- 选择项目 → 选择任务 → 确认导入

**完成！** 🎉

---

## 🔍 如果第1步找不到OAuth配置位置

### 方法A: 查看截图找线索

从您的截图看，左侧菜单有：
- 基本信息
- 开发
  - 插件功能 ← 您当前在这里
  - 权限管理
- 管理
  - 插件发布 ← 可能在这里
  - 安装统计

**建议检查**：
1. "插件功能"下是否有子菜单（展开看看）
2. "基本信息"中是否有OAuth相关配置
3. "管理"下的其他选项

### 方法B: 搜索飞书文档

在飞书开放平台右上角点击"帮助"或"文档"，搜索：
- "重定向URL"
- "Redirect URI"
- "OAuth回调"
- "网页授权"

### 方法C: 咨询飞书客服

1. 点击页面右下角的"帮助"按钮
2. 在线客服询问："我想配置OAuth 2.0的重定向URL，在哪里配置？"

### 方法D: 暂时跳过（先测试功能）

如果实在找不到，可以：
1. 先不配置回调URL
2. 点击"开始授权"看看会发生什么
3. 如果提示"回调地址未配置"，说明确实需要配置
4. 根据错误提示找到配置位置

---

## 📸 预期的配置界面

OAuth回调URL配置通常长这样：

```
重定向URL / Redirect URIs
┌────────────────────────────────────────┐
│ http://localhost:3000/feishu-callback  │ [删除]
│ https://你的域名/feishu-callback         │ [删除]
└────────────────────────────────────────┘
[+ 添加重定向URL]
```

---

## ✅ 配置完成检查

完成配置后，测试步骤：

1. ✅ 在WSJF点击"从飞书导入"
2. ✅ 填写Plugin ID和Secret
3. ✅ 点击"开始授权（跳转到飞书）"
4. ✅ **应该跳转到飞书授权页面**
5. ✅ **授权页面显示"WSJF-Lite 申请以下权限"**
6. ✅ **点击"同意授权"**
7. ✅ **自动返回WSJF并显示"授权成功"**
8. ✅ **能看到您的项目列表**

---

## ❓ 常见问题

### Q: 点击"开始授权"后没有跳转？

检查浏览器Console（F12），看是否有错误信息。

### Q: 跳转到飞书但提示"回调地址错误"？

说明回调URL配置不正确，请检查：
- URL是否完全一致（包括端口号）
- 是否已保存配置
- 是否已发布新版本

### Q: 授权后返回WSJF但提示错误？

可能原因：
- 权限配置不完整
- Plugin Secret错误
- 打开浏览器Console查看具体错误

### Q: 还是看不到项目列表？

确认：
- 您在飞书中确实有项目
- 您的账号有这些项目的访问权限
- 打开F12查看Console错误信息

---

## 📞 需要帮助？

如果按照本指南操作后仍有问题：

1. **截图浏览器Console的错误信息**（F12 → Console标签）
2. **截图网络请求详情**（F12 → Network标签，筛选"fetch/XHR"）
3. **告诉我具体在哪一步出错**

我可以帮您精确诊断问题！

---

**预计配置时间**: 5分钟
**预计测试时间**: 2分钟

配置完成后您就可以畅快使用飞书导入功能了！🚀
