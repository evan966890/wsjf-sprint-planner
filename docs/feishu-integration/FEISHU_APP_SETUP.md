# 飞书应用配置指南

**问题现象**: 点击"从飞书导入"后，在"选择项目"步骤显示"暂无项目"

**根本原因**: 飞书应用还未配置必要的API权限

---

## 快速配置步骤

### 步骤1: 进入飞书开放平台

1. 访问 https://open.feishu.cn
2. 登录您的飞书账号
3. 进入"开发者后台"
4. 找到您创建的应用（如截图中的"WSJF-Lite"）

### 步骤2: 添加应用能力

在应用详情页面，您会看到"未配置插件功能"的提示：

1. **点击"添加插件功能"按钮**

2. **选择"企业自建应用"类型**（如果有选择的话）

### 步骤3: 配置应用权限 ⭐ 重要！

在"权限管理"或"开发配置"页面：

#### 必需权限（必须添加）：

1. **项目管理权限**：
   - `project:project:readonly` 或 `project:read`
   - 说明: 读取项目列表

2. **工作项管理权限**：
   - `project:work_item:readonly` 或 `work_item:read`
   - 说明: 读取工作项（任务）列表

#### 具体操作：

1. 在左侧菜单找到"权限管理"或"应用权限"
2. 搜索或浏览找到以下权限：
   ```
   项目 (Project) 相关权限：
   ✅ 查看项目信息
   ✅ 查看项目列表

   工作项 (Work Item) 相关权限：
   ✅ 查看工作项信息
   ✅ 查看工作项列表
   ```

3. **点击"添加"或勾选这些权限**

4. **点击"保存"或"确认"**

### 步骤4: 发布应用版本

⚠️ **关键步骤** - 权限修改后需要发布新版本：

1. 在左侧菜单找到"版本管理与发布"
2. 点击"创建版本"
3. 填写版本说明（如"添加项目和工作项读取权限"）
4. 点击"保存"
5. **点击"申请发布"**
6. 等待审核通过（企业自建应用通常立即通过）

### 步骤5: 安装应用到企业

如果应用还未安装到您的企业：

1. 在应用详情页找到"可用性"或"应用发布"
2. 点击"申请线上发布"或"添加应用使用范围"
3. 选择可见范围（建议选择"全员可见"或您的部门）
4. 确认安装

### 步骤6: 验证配置

返回WSJF应用，重新测试：

1. 点击"从飞书导入"
2. 输入Plugin ID和Secret
3. 点击"保存并连接"
4. 如果连接成功，点击"刷新列表"
5. 应该能看到您的飞书项目列表了！

---

## 📸 配置示例图解

### 在飞书开放平台应该看到：

```
权限管理
├── 项目 (Project)
│   ✅ 查看项目信息          [project:project:readonly]
│   ✅ 查看项目列表          [project:project:list]
│
└── 工作项 (Work Item)
    ✅ 查看工作项信息        [project:work_item:readonly]
    ✅ 查看工作项列表        [project:work_item:list]
```

---

## ❓ 常见问题

### Q1: 找不到"项目"相关权限？

**A**: 可能的原因：
- 您的飞书版本不支持项目管理功能
- 企业未开通项目管理权限
- 权限名称可能不同，搜索关键词：`project`、`工作项`、`任务`

**解决方案**：
1. 联系飞书企业管理员确认是否开通了项目管理功能
2. 或者在权限列表中搜索所有包含"project"的权限并添加

### Q2: 权限已添加，但还是获取不到项目？

**A**: 检查清单：
- ✅ 权限是否已保存？
- ✅ 应用版本是否已发布？
- ✅ 应用是否已安装到企业？
- ✅ 当前登录用户是否有飞书项目的访问权限？
- ✅ 飞书中是否真的有项目？（去飞书项目管理中确认）

### Q3: 提示"权限不足"或"403错误"？

**A**: 说明权限配置不完整：
1. 重新检查上面列出的必需权限是否都已添加
2. 确认应用版本已发布
3. 尝试删除应用重新安装

### Q4: 提示"认证失败"或"401错误"？

**A**: Plugin ID或Secret错误：
1. 重新从飞书开放平台复制凭证
2. 确保没有多余的空格
3. 确认应用状态为"已启用"

---

## 🔍 调试步骤

如果配置后仍有问题，打开浏览器开发者工具（F12）：

1. 切换到"Console"标签
2. 点击"从飞书导入" → "保存并连接"
3. 查看是否有红色错误信息
4. 截图错误信息发送给我分析

### 错误码对照表：

| 错误码 | 含义 | 解决方案 |
|--------|------|----------|
| 401 | 认证失败 | 检查Plugin ID和Secret |
| 403 | 权限不足 | 添加必需的API权限 |
| 404 | 资源不存在 | 确认飞书中有项目 |
| 10014 | app_access_token无效 | 重新获取凭证 |
| 10016 | app权限不足 | 检查权限配置 |

---

## 📋 完整配置检查清单

在联系技术支持前，请确认以下所有步骤都已完成：

- [ ] 飞书开放平台已创建应用
- [ ] 应用已添加"项目管理"相关权限
- [ ] 应用已添加"工作项管理"相关权限
- [ ] 应用已创建并发布新版本
- [ ] 应用已安装到企业
- [ ] Plugin ID和Secret已正确复制到WSJF
- [ ] 当前用户在飞书中有项目访问权限
- [ ] 飞书中确实存在可访问的项目

---

## 🆘 需要帮助？

如果按照以上步骤操作后仍然无法解决，请提供以下信息：

1. 飞书开放平台的权限配置截图
2. 浏览器Console中的错误信息截图
3. 网络请求详情（Network标签）

---

**预计配置时间**: 5-10分钟
**难度**: ⭐⭐☆☆☆（中等）

配置完成后，您就可以顺利从飞书导入项目数据到WSJF系统了！
