# 飞书用户授权模式说明

## 🎯 问题

当前实现使用的是**应用授权（tenant_access_token）**，需要管理员为整个租户安装应用。
但大多数用户只需要读取**个人可见的飞书项目数据**，不需要租户级别的权限。

## ✅ 解决方案：切换到用户授权模式

使用**用户授权（user_access_token）**，通过OAuth 2.0流程让用户授权，只读取该用户有权限的数据。

---

## 📐 两种授权模式对比

| 特性 | 应用授权 (tenant_access_token) | 用户授权 (user_access_token) |
|------|-------------------------------|------------------------------|
| 安装范围 | 整个租户 | 个人用户 |
| 需要管理员 | ✅ 是 | ❌ 否 |
| 数据范围 | 租户内所有数据 | 用户个人可访问的数据 |
| 授权流程 | 应用安装 | OAuth 2.0授权 |
| 适用场景 | 企业级集成 | 个人工具、小团队 |
| **推荐度** | 企业应用 | **✅ 您的场景（推荐）** |

---

## 🔄 需要修改的内容

### 方案A: 完整的用户授权流程（标准OAuth 2.0）

**优点**: 安全、标准、无需管理员权限
**缺点**: 需要配置回调URL、实现OAuth流程

**实现步骤**：
1. 在飞书开放平台配置OAuth回调URL
2. 修改feishuAuth.ts支持用户授权
3. 实现OAuth授权页面跳转和回调处理
4. 使用user_access_token调用API

### 方案B: 使用飞书网页授权（简化版）

**优点**: 实现简单、快速
**缺点**: 需要用户手动获取access_token

**实现步骤**：
1. 用户在飞书开放平台手动获取个人access_token
2. 在WSJF配置页面输入user_access_token
3. 直接使用该token调用API

---

## 💡 我的建议

根据您的需求，我推荐**方案A（用户授权流程）**，这样您无需管理员权限，也能从飞书读取个人视图的数据。

我现在可以为您修改代码，实现用户授权模式。需要做的改动：

1. 修改 `feishuAuth.ts` - 支持用户授权
2. 修改 `FeishuImportModal.tsx` - 添加OAuth授权按钮
3. 添加OAuth回调处理页面
4. 更新配置说明

是否需要我现在就修改代码？这大约需要30分钟。

---

## 🚀 临时快速解决方案（5分钟）

如果您想立即测试，可以先用**个人访问令牌**：

### 步骤1: 获取个人访问令牌

1. 在飞书开放平台 → 您的应用 → "开发" → "权限管理"
2. 找到"开发者文档"中的API调试工具
3. 或使用飞书提供的调试工具获取临时的user_access_token

### 步骤2: 我修改代码支持直接输入user_access_token

这个方案很快，我可以立即修改代码让您输入user_access_token进行测试。

---

您希望我：
1. **完整实现OAuth用户授权**（标准方案，约30分钟）
2. **快速支持手动输入user_access_token**（临时方案，5分钟）
3. **先看看如何获取个人访问令牌再决定**

请告诉我您的选择！
