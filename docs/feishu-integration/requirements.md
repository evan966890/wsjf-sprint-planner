# 飞书项目管理对接需求文档

**版本**: v1.0
**日期**: 2025-10-26
**状态**: 待开发

---

## 1. 需求背景

### 1.1 业务场景

目前WSJF Sprint Planner需要用户手动创建需求或通过Excel/Word等文件导入需求数据。随着团队使用飞书项目进行项目管理，需求数据已经维护在飞书项目中。为了提升效率，减少重复录入，需要实现从飞书项目直接同步需求数据到WSJF系统的功能。

### 1.2 用户价值

- **提升效率**: 自动从飞书同步需求，无需手动录入或导出Excel
- **减少错误**: 避免手动录入导致的数据错误
- **数据一致**: 确保飞书项目与WSJF系统数据同步
- **简化流程**: 一键导入，简化操作流程

### 1.3 目标用户

- 产品经理：需要从飞书项目导入需求进行WSJF评分和排期
- 项目经理：需要同步飞书项目数据进行迭代规划
- 研发负责人：需要查看飞书项目需求并进行技术评估

---

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 飞书项目列表获取

**功能描述**:
用户在WSJF系统中可以查看和选择飞书空间下的项目列表。

**交互流程**:
1. 用户点击"从飞书导入"按钮
2. 系统调用飞书API获取用户可访问的项目空间列表
3. 展示项目空间列表供用户选择
4. 用户选择目标项目空间后，系统获取该空间下的所有项目
5. 展示项目列表供用户选择

**数据字段**:
- 项目空间名称
- 项目名称
- 项目描述
- 项目状态（进行中/已完成/已归档等）
- 项目成员数量
- 任务数量

**界面元素**:
- 项目空间下拉选择器
- 项目列表（卡片形式或表格形式）
- 项目搜索框
- 项目筛选器（按状态筛选）

#### 2.1.2 飞书任务数据获取

**功能描述**:
用户选择飞书项目后，系统获取该项目下的所有任务（工作项）数据。

**交互流程**:
1. 用户选择目标飞书项目
2. 系统调用飞书API获取该项目下的任务列表
3. 展示任务数据预览，允许用户选择需要导入的任务

**数据字段映射**:

| 飞书字段 | WSJF字段 | 映射规则 | 必填 |
|---------|---------|---------|------|
| 任务标题 | name | 直接映射 | ✅ |
| 任务描述 | description | 直接映射 | ❌ |
| 创建人 | submitterName | 直接映射 | ✅ |
| 创建时间 | submitDate | 格式转换(YYYY-MM-DD) | ✅ |
| 截止日期 | deadlineDate | 格式转换(YYYY-MM-DD) | ❌ |
| 任务类型 | type | 映射表转换 | ❌ |
| 负责人 | productManager | 直接映射 | ❌ |
| 工时预估 | effortDays | 单位转换(小时→天) | ❌ |
| 任务状态 | techProgress/productProgress | 映射表转换 | ❌ |
| 优先级 | - | 用于AI智能评分参考 | ❌ |
| 标签 | businessDomain | 智能识别或手动映射 | ❌ |

**特殊处理**:
- 工时单位转换：飞书通常以"小时"为单位，WSJF以"天"为单位，需进行转换（8小时=1天）
- 状态映射：飞书任务状态需映射到WSJF的技术进度和产品进度状态
- 日期格式：统一转换为YYYY-MM-DD格式

#### 2.1.3 字段智能映射

**功能描述**:
系统提供智能字段映射功能，自动识别飞书字段与WSJF字段的对应关系，并允许用户手动调整。

**交互流程**:
1. 系统自动分析飞书任务字段
2. 基于字段名称相似度进行智能映射
3. 展示映射关系表，用户可手动调整
4. 保存映射关系，下次使用时自动应用

**智能映射规则**:
- 字段名称完全匹配：直接映射
- 字段名称包含关键词：建议映射（如"负责人"→"productManager"）
- 自定义字段：允许用户手动选择映射目标
- 支持一对多映射（如飞书的"负责人"可同时映射到产品经理和研发负责人）

**映射配置持久化**:
- 保存用户的映射配置
- 支持多套映射模板（如"新零售项目模板"、"渠道零售项目模板"）
- 支持导入/导出映射模板

#### 2.1.4 数据预览与确认

**功能描述**:
在正式导入前，用户可以预览即将导入的数据，并进行最后确认。

**交互流程**:
1. 系统展示映射后的数据预览表
2. 高亮显示数据问题（如必填字段缺失、数据格式错误等）
3. 允许用户勾选需要导入的任务
4. 用户确认后执行导入

**预览界面元素**:
- 数据预览表（展示所有映射后的字段）
- 任务选择复选框
- 批量选择/取消选择按钮
- 数据验证结果标识（✅成功 / ⚠️警告 / ❌错误）
- 导入设置：
  - 是否覆盖现有数据
  - 是否触发AI智能评分

#### 2.1.5 AI智能评分集成（可选）

**功能描述**:
导入飞书任务后，可选择性地触发AI智能评分，自动填充WSJF评分字段。

**交互流程**:
1. 用户在导入设置中勾选"启用AI智能评分"
2. 系统调用AI接口，基于任务描述、优先级等信息进行评分
3. AI自动填充业务影响度、时间窗口、技术复杂度等字段
4. 用户可在导入后手动调整AI评分结果

**AI评分输入**:
- 任务标题
- 任务描述
- 飞书优先级
- 截止日期
- 标签/分类

**AI评分输出**:
- businessImpactScore（业务影响度评分1-10）
- timeCriticality（时间窗口）
- complexityScore（技术复杂度评分1-10）
- 评分理由说明

---

### 2.2 辅助功能

#### 2.2.1 飞书认证配置

**功能描述**:
管理员可以配置飞书应用的认证信息。

**配置项**:
- Plugin ID（应用ID）
- Plugin Secret（应用密钥）
- 权限范围说明
- 测试连接功能

**安全要求**:
- Secret字段脱敏显示（如：050E******564F）
- 配置信息加密存储
- 仅管理员可见

#### 2.2.2 同步记录与日志

**功能描述**:
记录每次从飞书同步数据的历史，便于追溯和问题排查。

**记录内容**:
- 同步时间
- 同步的飞书项目名称
- 导入任务数量
- 成功/失败数量
- 失败原因详情
- 操作人

**日志查看**:
- 同步历史列表
- 日志详情查看
- 日志导出

#### 2.2.3 增量同步（未来扩展）

**功能描述**:
支持增量同步，只同步飞书项目中新增或修改的任务。

**实现方式**:
- 记录上次同步时间戳
- 基于任务更新时间进行增量获取
- 冲突处理策略（飞书优先/WSJF优先/手动选择）

---

## 3. 非功能需求

### 3.1 性能要求

- **API调用响应时间**: 单次飞书API调用响应时间 < 3秒
- **数据加载**: 100条任务数据加载时间 < 5秒
- **界面响应**: 用户操作响应时间 < 1秒

### 3.2 安全要求

- **认证信息加密**: 飞书Plugin Secret必须加密存储
- **权限控制**: 只有管理员可配置飞书认证信息
- **数据传输**: 使用HTTPS进行API调用
- **敏感信息脱敏**: 日志中不记录完整的Secret

### 3.3 兼容性要求

- **浏览器兼容**: 支持Chrome、Edge、Safari、Firefox最新两个版本
- **飞书API版本**: 兼容飞书开放平台最新稳定版API
- **数据格式**: 兼容现有WSJF数据格式，确保数据向后兼容

### 3.4 易用性要求

- **操作步骤**: 从打开导入界面到完成导入 ≤ 5步操作
- **错误提示**: 所有错误都有清晰的中文提示和解决建议
- **帮助文档**: 提供飞书对接的操作指南和常见问题FAQ

---

## 4. 约束条件

### 4.1 技术约束

- 必须使用现有的React + TypeScript技术栈
- 必须符合项目的文件大小规范（单文件 < 500行）
- 必须使用Zustand进行状态管理
- 飞书API调用必须在前端进行（无后端服务）

### 4.2 业务约束

- 飞书应用必须已创建并获得相应权限
- 用户必须有飞书项目的访问权限
- 导入的任务数据格式必须符合WSJF Requirement接口定义

### 4.3 时间约束

- 开发周期：5个工作日
- 测试周期：2个工作日
- 上线时间：按项目计划执行

---

## 5. 验收标准

### 5.1 功能验收

- ✅ 能够成功连接飞书API并获取项目列表
- ✅ 能够获取选定项目的任务列表
- ✅ 字段映射正确，必填字段无遗漏
- ✅ 数据预览准确，导入成功率 > 95%
- ✅ AI智能评分功能正常（如启用）
- ✅ 导入的需求能正常显示和操作

### 5.2 性能验收

- ✅ 100条任务数据导入时间 < 10秒
- ✅ 界面无明显卡顿
- ✅ API调用无超时错误

### 5.3 安全验收

- ✅ 飞书Secret加密存储
- ✅ API调用使用HTTPS
- ✅ 无敏感信息泄露

### 5.4 用户体验验收

- ✅ 操作流程清晰，无需查看文档即可完成基本操作
- ✅ 错误提示友好，能指导用户解决问题
- ✅ 界面美观，符合现有设计风格

---

## 6. 风险与挑战

### 6.1 技术风险

**风险1: 飞书API限流**
- **描述**: 飞书API可能存在调用频率限制
- **影响**: 大批量导入时可能失败
- **应对**: 实现请求队列和重试机制，添加进度显示

**风险2: 字段映射复杂度**
- **描述**: 不同飞书项目可能有不同的自定义字段
- **影响**: 自动映射准确率下降
- **应对**: 提供灵活的手动映射界面，保存映射模板

**风险3: 跨域请求限制**
- **描述**: 前端直接调用飞书API可能遇到CORS问题
- **影响**: 无法获取数据
- **应对**: 使用飞书提供的前端SDK，或考虑代理方案

### 6.2 业务风险

**风险1: 数据格式不匹配**
- **描述**: 飞书任务数据可能不完整或格式不符合WSJF要求
- **影响**: 导入失败或数据缺失
- **应对**: 实现数据验证和错误提示，允许用户手动补充

**风险2: 用户权限不足**
- **描述**: 用户可能没有飞书项目的访问权限
- **影响**: 无法获取项目数据
- **应对**: 提供清晰的权限说明和申请指引

---

## 7. 后续迭代规划

### v1.1 - 双向同步
- WSJF中的需求变更可以同步回飞书项目
- 支持状态同步（如WSJF中标记完成，飞书中也更新状态）

### v1.2 - 批量操作
- 支持批量选择多个飞书项目进行导入
- 支持批量修改导入数据

### v1.3 - 自动同步
- 支持定时自动同步（如每天自动同步一次）
- 支持WebHook触发同步（飞书项目更新时自动同步）

---

## 8. 附录

### 8.1 飞书API参考

- [飞书开放平台文档](https://open.feishu.cn/document/home/index)
- [飞书项目API](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/project-v1/project/list)
- [飞书工作项API](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/project-v1/work_item/list)

### 8.2 相关文档

- [WSJF数据类型定义](../../src/types/index.ts)
- [WSJF导入功能](../../src/hooks/useDataImport.ts)
- [项目架构文档](../architecture-guide.md)

---

**文档维护**:
- 创建人: Claude
- 创建日期: 2025-10-26
- 最后更新: 2025-10-26
- 审核状态: 待审核
