# 飞书应用体系架构说明

## 🏗️ 飞书开放平台的整体架构

想象一下，飞书开放平台就像是一个"应用商店"，你可以在里面创建不同类型的"应用"来扩展飞书的功能。

```
飞书开放平台（https://open.feishu.cn）
└── 开发者后台
    ├── 标准飞书应用（企业自建应用）  ← 方案2推荐创建这个
    │   ├── App ID: cli_xxxxx
    │   ├── 支持：OAuth 2.0、完整API
    │   └── 场景：通用应用（聊天机器人、审批流、第三方集成等）
    │
    ├── 飞书项目插件（Project Plugin）  ← 这就是你现在的 MII_xxx
    │   ├── Plugin ID: MII_xxxxx
    │   ├── 支持：项目专用API（可能不支持OAuth）
    │   └── 场景：专门为飞书项目管理定制的插件
    │
    └── 其他类型
        ├── 小程序
        ├── 网页应用
        └── ...
```

---

## 🔍 你现在的情况

### 你已经有的：飞书项目插件
```
类型：飞书项目插件（Project Plugin）
Plugin ID: MII_68F1064FA240006C
Plugin Secret: 050E0E049ACB87339CB9D11E5641564F

创建位置：飞书开放平台 → 创建项目插件
用途：专门为飞书"项目管理"功能设计的插件
```

**问题**：这种插件类型**不支持OAuth 2.0授权**，导致WSJF的自动授权功能无法使用。

---

## 💡 方案2建议：创建标准飞书应用

### 为什么需要创建另一个应用？

**类比**：
- 飞书项目插件 = iOS的"小组件（Widget）"
- 标准飞书应用 = iOS的"完整App"

小组件功能有限，只能做特定的事情。如果你想要更强大的功能（比如OAuth授权），就需要创建一个完整的App。

### 它们的关系是什么？

```
飞书开放平台（统一管理）
├── 你现在的项目插件（MII_68F1064FA240006C）
│   └── 功能有限，不支持OAuth
│
└── 你将创建的标准应用（cli_新的ID）  ← 新建这个
    └── 功能完整，支持OAuth
```

**关键点**：
1. ✅ 它们都在**同一个飞书开放平台**创建和管理
2. ✅ 它们是**两个独立的应用**（可以同时存在）
3. ✅ 标准应用可以访问**相同的飞书数据**（项目、任务）
4. ✅ 标准应用支持**更强大的授权方式**（OAuth 2.0）

---

## 🎯 创建标准应用后会怎样？

### 创建前（现在）
```
WSJF应用
  ↓ 想要使用OAuth授权
  ↓
飞书项目插件（MII_xxx）
  ↓
❌ 报错：不支持OAuth（错误码20028）
```

### 创建后
```
WSJF应用
  ↓ 使用OAuth授权
  ↓
标准飞书应用（cli_xxx）  ← 新创建的
  ↓ OAuth 2.0授权
  ↓
✅ 成功获取Token
  ↓
✅ 读取飞书项目和任务数据
```

---

## 📊 详细对比表

| 项目 | 飞书项目插件（你现在的） | 标准飞书应用（方案2） |
|------|----------------------|-------------------|
| **创建位置** | 飞书开放平台 | 飞书开放平台（同一个地方） |
| **ID格式** | `MII_68F1064FA240006C` | `cli_新的随机ID` |
| **创建方式** | 创建"项目插件" | 创建"企业自建应用" |
| **支持OAuth** | ❌ 不支持 | ✅ 支持 |
| **访问数据** | 飞书项目、任务 | 飞书项目、任务（相同） |
| **授权方式** | 手动Token或Cookie | OAuth 2.0自动授权 |
| **Token管理** | 手动维护 | 自动刷新 |
| **安全性** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **用户体验** | 需要手动配置 | 点击授权即可 |
| **是否冲突** | ❌ 不冲突，可同时存在 | ❌ 不冲突，可同时存在 |

---

## 🤔 常见疑问解答

### Q1: 创建标准应用会删除我的项目插件吗？
**A**: ❌ 不会！它们是两个独立的应用，可以同时存在。

就像你可以在手机上同时安装微信和企业微信一样。

---

### Q2: 标准应用能访问相同的飞书数据吗？
**A**: ✅ 能！只要配置相同的权限，就能访问相同的数据。

**权限配置**：
- 项目插件需要的权限：项目读取、工作项读取
- 标准应用需要的权限：项目读取、工作项读取（完全相同）

---

### Q3: 为什么不直接修复项目插件，而是创建新应用？
**A**: 因为飞书项目插件的**类型限制**，它天生不支持OAuth 2.0。

**类比**：
- 这就像你买了一个"收音机"（项目插件）
- 发现它不能播放视频
- 你需要再买一个"电视机"（标准应用）
- 不是收音机坏了，而是它本来就不支持视频功能

---

### Q4: 创建标准应用后，WSJF代码需要改吗？
**A**: ✅ 完全不需要！我的代码已经完美支持两种方式。

**只需要**：
1. 在飞书开放平台创建标准应用（5分钟）
2. 复制新的 App ID 和 Secret
3. 在WSJF界面填入新凭证
4. 完成！

---

### Q5: 如果我不想创建新应用怎么办？
**A**: 可以使用方案1（手动Token），但有缺点：

**方案1：使用手动Token**
- ✅ 优点：不需要创建新应用
- ❌ 缺点：
  - Token可能过期，需要手动更新
  - 安全性较低
  - 用户体验不好

**方案2：创建标准应用**
- ✅ 优点：
  - OAuth自动授权，Token自动刷新
  - 更安全
  - 用户体验极佳
- ❌ 缺点：
  - 需要花5分钟创建应用（仅一次）

---

## 🎯 推荐决策树

```
你想要什么？
│
├─ 我想要简单、快速（不在乎安全性和用户体验）
│  └─ 选择方案1：手动Token
│     └─ 需要：在飞书开放平台找到Token生成功能
│
└─ 我想要安全、自动、长期使用
   └─ 选择方案2：创建标准应用 ⭐⭐⭐⭐⭐ 强烈推荐
      └─ 需要：花5分钟在飞书开放平台创建应用
```

---

## 📖 创建标准应用的完整流程

### 步骤1：打开飞书开放平台
访问：https://open.feishu.cn （就是你现在管理项目插件的地方）

### 步骤2：创建企业自建应用
1. 点击右上角 **"创建应用"**
2. 选择 **"企业自建应用"** 类型（不是"项目插件"）
3. 填写名称：WSJF Sprint Planner
4. 点击创建

### 步骤3：配置权限
在新应用的"权限管理"页面添加：
- ✅ 获取用户信息
- ✅ 查看项目列表
- ✅ 查看工作项列表

### 步骤4：配置OAuth回调地址
在"安全设置"或"OAuth设置"添加：
```
http://localhost:3000/feishu-callback
```

### 步骤5：发布应用
在"版本管理"创建并发布版本

### 步骤6：获取凭证
在"凭证与基础信息"页面复制：
- App ID（格式：cli_xxxxxxxxxx）
- App Secret

### 步骤7：在WSJF中使用
1. 启动 `npm run dev`
2. 点击"从飞书导入"
3. 填入新的 App ID 和 Secret
4. 选择"OAuth用户授权"模式
5. 点击"开始授权"
6. 完成！

---

## ✅ 总结

| 问题 | 答案 |
|------|------|
| 插件和开放平台是什么关系？ | 都在同一个飞书开放平台管理 |
| 为什么要创建新应用？ | 项目插件不支持OAuth，需要功能更完整的标准应用 |
| 会影响现有插件吗？ | ❌ 不会，两者独立 |
| 能访问相同数据吗？ | ✅ 能，配置相同权限即可 |
| 代码需要改吗？ | ❌ 不需要，已支持 |
| 推荐哪个方案？ | ⭐⭐⭐⭐⭐ 方案2（创建标准应用） |

---

**现在你明白了吗？如果还有疑问，请随时问我！** 😊
