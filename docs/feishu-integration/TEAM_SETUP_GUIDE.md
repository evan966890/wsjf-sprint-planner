# WSJF飞书集成 - 团队使用指南

## 🎯 团队使用场景

你们团队想要：
- ✅ 多人协作使用WSJF
- ✅ 共享需求池和优先级排序
- ✅ 从飞书导入需求

---

## 💡 推荐方案：部署到服务器

### 为什么推荐部署？

**不部署（本地运行）**：
- ❌ 每个人都要git clone、npm install、npm run dev
- ❌ 数据不共享（每个人的localStorage独立）
- ❌ 无法团队协作
- ❌ 维护成本高

**部署后**：
- ✅ 所有人访问同一个URL
- ✅ 数据共享（团队协作）
- ✅ 无需本地安装
- ✅ 维护成本低

---

## 🚀 部署步骤（选一种）

### 方案A：Vercel部署（免费，最推荐）⭐⭐⭐⭐⭐

**优点**：
- ✅ 完全免费
- ✅ 自动HTTPS
- ✅ 全球CDN加速
- ✅ 5分钟完成部署

**步骤**：

1. **安装Vercel CLI**
   ```bash
   npm install -g vercel
   ```

2. **登录Vercel**
   ```bash
   vercel login
   ```
   - 使用GitHub/GitLab/Email登录

3. **部署**
   ```bash
   npm run deploy:vercel
   ```
   - 第一次会问几个问题，全部回车使用默认值即可

4. **获取URL**
   - 部署成功后会显示URL（如：`https://wsjf-sprint-planner.vercel.app`）
   - 分享这个URL给团队成员

5. **后续更新**
   - 修改代码后，再次运行 `npm run deploy:vercel`
   - 自动更新部署

---

### 方案B：腾讯云部署（已配置）⭐⭐⭐⭐

**优点**：
- ✅ 国内访问速度快
- ✅ 已有配置脚本

**步骤**：

1. **配置腾讯云账号**
   - 需要腾讯云账号
   - 开通CloudBase服务

2. **部署**
   ```bash
   npm run deploy:tencent
   ```

---

### 方案C：公司内网服务器⭐⭐⭐

**适用于**：
- 公司有内网服务器
- 不想公开到互联网

**步骤**：

1. **构建项目**
   ```bash
   npm run build
   ```
   - 生成的文件在 `dist` 目录

2. **部署到内网服务器**
   - 将 `dist` 目录内容复制到服务器（如：nginx、Apache）
   - 配置服务器指向这个目录

3. **配置代理**（重要！）
   - 因为飞书API有CORS限制，需要在服务器配置代理
   - 见下方"生产环境代理配置"

---

## 🔑 关于凭证共享

### ✅ 可以团队共享的

这些凭证代表**WSJF应用本身**，可以团队共享：

```
Plugin ID: MII_68F1064FA240006C
Plugin Secret: 050E0E049ACB87339CB9D11E5641564F
Platform Domain: https://project.f.mioffice.cn
工作项类型: story
```

**如何共享**：

#### 方法1：创建团队配置文件（推荐）

```bash
# 1. 复制示例文件
cp .env.example .env.local

# 2. 填入团队共享凭证
# 编辑 .env.local，填入上面的值
```

团队成员拉取代码后，也复制相同的配置。

#### 方法2：写入代码（不推荐，安全风险）

直接在配置文件中写死凭证（不要提交到Git）。

---

### ⚠️ User Key的问题

**User Key代表个人身份**，影响：
- ✅ 从飞书导入时，只能看到你有权限的数据
- ✅ 操作记录会显示是谁操作的

**两种处理方式**：

#### 选项A：使用统一的User Key（简单）
- 所有人使用同一个 User Key（如：你的）
- 优点：配置简单
- 缺点：无法区分是谁导入的需求

#### 选项B：每个人使用自己的User Key（规范）
- 每个人配置自己的 User Key
- 优点：权限隔离，操作可追溯
- 缺点：每个人要单独配置

---

## 📋 推荐的团队工作流程

### 步骤1：管理员部署（一次性）

你作为管理员：

```bash
# 1. 部署到Vercel
npm run deploy:vercel

# 2. 获取URL
# 例如：https://wsjf-sprint-planner.vercel.app
```

### 步骤2：配置飞书凭证

在部署的网站上（所有人访问同一个URL）：

1. **首次使用时配置**（任意一个人配置即可）：
   ```
   Plugin ID: MII_68F1064FA240006C
   Plugin Secret: 050E0E049ACB87339CB9D11E5641564F
   User Key: 你的或团队共用的
   ```

2. **配置会保存在浏览器localStorage**
   - 每个人第一次访问时需要配置
   - 或者使用"统一User Key"，配置一次就够

### 步骤3：团队成员使用

团队成员：
1. 访问部署的URL
2. 开始使用（无需本地安装）
3. 从飞书导入需求
4. 进行WSJF排期

---

## 🔒 安全性说明

### Plugin Secret的安全

**问题**：Plugin Secret是敏感信息，不应该暴露在前端代码中。

**当前状态**：
- ⚠️ Secret存储在浏览器localStorage中
- ⚠️ 任何访问网页的人都能看到

**改进方案（可选）**：

如果你担心安全问题，可以：

1. **开发一个简单的后端服务**
   - 后端保存Plugin ID/Secret
   - 前端通过后端API获取Token
   - 用户只需要输入User Key

2. **使用环境变量**（Vercel支持）
   - 在Vercel Dashboard配置环境变量
   - 不暴露在前端代码中

但对于**内部团队工具**，当前的方式已经足够了。

---

## 📊 对比表

| 方案 | 维护成本 | 团队协作 | 访问方式 | 推荐度 |
|------|---------|---------|---------|--------|
| Vercel部署 | ⭐ 最低 | ✅ 支持 | URL访问 | ⭐⭐⭐⭐⭐ |
| 腾讯云部署 | ⭐⭐ 低 | ✅ 支持 | URL访问 | ⭐⭐⭐⭐ |
| 内网服务器 | ⭐⭐⭐ 中 | ✅ 支持 | 内网URL | ⭐⭐⭐ |
| 本地运行 | ⭐⭐⭐⭐⭐ 高 | ❌ 不支持 | 各自本地 | ⭐ |

---

## 🎯 我的建议

**立即行动**：

1. **现在就部署到Vercel**（5分钟）：
   ```bash
   npm install -g vercel
   vercel login
   npm run deploy:vercel
   ```

2. **获取URL并分享给团队**

3. **在飞书插件后台添加生产环境回调URL**（如果需要OAuth）

4. **团队成员直接访问URL开始使用**

---

## 🔧 生产环境的额外配置

部署后，还需要：

1. **更新Vite代理配置**（生产环境不需要代理）
   - 已处理：开发环境用 `/feishu-proxy`，生产环境直接访问

2. **配置飞书CORS白名单**（可能需要）
   - 联系飞书管理员
   - 添加你的部署域名到白名单

---

**你想用哪种方案？我可以帮你完成部署！** 🚀

最推荐：**Vercel**（免费、快速、零维护）