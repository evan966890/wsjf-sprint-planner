# 创建标准飞书应用指南

## 🎯 为什么需要标准应用？

你当前使用的是**飞书项目插件**（Plugin ID: `MII_68F1064FA240006C`），它**不支持OAuth 2.0授权**，导致错误：
```
错误码：20028
app_id 请求不合法
```

**解决方案**：创建一个**标准飞书应用**，支持完整的OAuth授权流程。

---

## ⚡ 创建步骤（5分钟）

### 第1步：进入飞书开放平台

访问：https://open.feishu.cn

### 第2步：创建企业自建应用

1. 点击右上角 **"创建应用"** 或 **"创建企业自建应用"**
2. 选择 **"企业自建应用"** 类型
3. 填写应用信息：
   - **应用名称**: WSJF Sprint Planner（或任意名称）
   - **应用描述**: 用于WSJF优先级排期的需求管理工具
   - **应用图标**: 上传一个图标（可选）

4. 点击 **"创建"**

### 第3步：配置应用权限

创建成功后，在应用管理页面：

#### 1. 添加必需权限

进入 **"权限管理"** 页面，搜索并添加以下权限：

**基础权限**：
- ✅ `contact:user.base:readonly` - 获取用户基本信息（OAuth必需）

**项目管理权限**：
- ✅ `project:project:readonly` 或 `获取项目列表`
- ✅ `project:work_item:readonly` 或 `获取工作项列表`

具体权限名称可能略有不同，搜索关键词：
- "用户信息"
- "项目"
- "工作项"

#### 2. 配置OAuth回调地址

找到 **"安全设置"** 或 **"网页"** 或 **"OAuth设置"**，添加：

**开发环境回调地址**：
```
http://localhost:3000/feishu-callback
```

**生产环境回调地址**（如有需要）：
```
https://你的域名/feishu-callback
```

### 第4步：获取应用凭证

进入 **"凭证与基础信息"** 页面：

复制以下信息：
- **App ID**（格式：`cli_xxxxxxxxxx`）
- **App Secret**（点击"查看"并复制）

⚠️ **注意**：标准应用的 App ID 是 `cli_` 开头，不是 `MII_` 开头！

### 第5步：发布应用版本

1. 进入 **"版本管理与发布"**
2. 点击 **"创建版本"**
3. 填写版本说明
4. 点击 **"申请发布"**
5. 等待审核通过（企业自建应用通常立即通过）

### 第6步：启用应用范围

1. 进入 **"可用性"** 或 **"应用发布"**
2. 选择可用范围：
   - **全员可见**（推荐）或
   - **指定部门/成员**
3. 保存设置

---

## 🚀 在WSJF中使用新应用

配置完成后：

1. **启动开发服务器**：
   ```bash
   npm run dev
   ```

2. **打开浏览器**：http://localhost:3000

3. **点击"从飞书导入"**

4. **填写新的应用凭证**：
   - **Plugin ID**: 填入新的 `cli_xxxxxxxxxx`
   - **Plugin Secret**: 填入新的 App Secret
   - **授权模式**: 选择 **"OAuth用户授权"**（不是手动Token）

5. **点击"开始授权（跳转到飞书）"**

6. **在飞书页面同意授权**

7. **自动返回WSJF，开始使用！** 🎉

---

## 📊 标准应用 vs 项目插件对比

| 特性 | 标准飞书应用 | 飞书项目插件 |
|------|-------------|-------------|
| App ID格式 | `cli_xxxxx` | `MII_xxxxx` |
| OAuth 2.0支持 | ✅ 支持 | ❌ 不支持 |
| Token自动刷新 | ✅ 自动 | ❌ 需手动 |
| 用户授权流程 | ✅ 标准流程 | ❌ 不可用 |
| API兼容性 | ✅ 标准API | ⚠️ 可能有限制 |
| 推荐程度 | ⭐⭐⭐⭐⭐ | ⭐⭐ |

---

## ❓ 常见问题

### Q: 创建标准应用会影响现有的项目插件吗？
**A**: 不会。它们是独立的，可以同时存在。

### Q: 是否需要管理员权限？
**A**:
- 创建应用：可能需要企业管理员权限
- 使用应用：只需用户个人授权，无需管理员

如果你没有创建应用的权限，请联系企业管理员帮忙创建。

### Q: 创建后能访问哪些数据？
**A**: 只能访问**用户授权后允许的数据**，即用户个人有权限的项目和任务。

### Q: 数据安全吗？
**A**:
- ✅ OAuth 2.0是行业标准的安全授权协议
- ✅ Token加密存储在浏览器localStorage
- ✅ 应用只读数据，不会修改或删除

---

## 🆘 需要帮助？

如果在创建过程中遇到问题：

1. **截图飞书开放平台的页面**
2. **告诉我具体在哪一步卡住了**
3. **我会提供详细的指导**

---

## ✅ 完成检查清单

创建标准应用后，确认：

- [ ] App ID 是 `cli_` 开头（不是 `MII_`）
- [ ] 已添加3个必需权限
- [ ] 已配置OAuth回调地址
- [ ] 已发布应用版本
- [ ] 已设置应用可用范围
- [ ] 在WSJF中使用新凭证测试成功

---

**预计耗时**: 5-10分钟
**推荐程度**: ⭐⭐⭐⭐⭐ 强烈推荐

创建标准应用后，你将获得更好的使用体验！
