# 🔑 超详细操作指南 - 获取飞书项目API凭证

## 步骤1：登录飞书项目

1. 打开浏览器（推荐Chrome或Edge）
2. 访问：https://project.f.mioffice.cn/iretail
3. 输入账号密码登录

## 步骤2：打开开发者工具

1. 登录成功后，**先不要离开页面**
2. 按键盘上的 **F12** 键（或右键点击页面，选择"检查"）
3. 开发者工具会在浏览器右侧或底部打开
4. 在开发者工具中找到并点击 **Network（网络）** 标签
5. 在Network面板中，勾选 **☑ Preserve log（保留日志）** - 这很重要！

## 步骤3：进入字段管理页面

1. 在浏览器地址栏输入：
   ```
   https://project.f.mioffice.cn/iretail/setting/workObject/story?menuTab=fieldManagement
   ```
2. 按回车访问
3. 页面会显示"字段管理"界面

## 步骤4：创建测试字段（关键步骤）

### 4.1 点击新建按钮
- 在字段管理页面，找到 **"新建字段"** 或 **"+ 字段"** 按钮
- 通常在页面右上角或表格上方
- 点击这个按钮

### 4.2 填写字段信息
会弹出一个对话框，填写以下信息：

| 字段 | 填写内容 |
|------|---------|
| **字段名称** | 测试字段（或任意名称） |
| **对接标识** | test_field（或任意英文） |
| **字段类型** | 选择"数字"或"文本" |
| **字段描述** | 测试用（可选） |
| **权限设置** | 选择"所有人可见"（如果有） |

### 4.3 点击确定
- 点击对话框底部的 **"确定"** 或 **"创建"** 按钮
- 这时会发送API请求

## 步骤5：捕获网络请求（最重要）

### 5.1 在Network面板中查找请求
1. 点击确定后，立即查看开发者工具的Network面板
2. 你会看到很多网络请求
3. 寻找以下特征的请求：
   - **名称**：包含 `field` 的请求
   - **方法**：`POST`
   - **状态**：200（绿色）
   - **完整URL可能是**：`/goapi/v3/settings/iretail/story/field`

### 5.2 点击找到的请求
1. 点击这个 `field` 请求
2. 右侧会显示请求详情
3. 点击 **Headers（标头）** 标签

### 5.3 提取所需信息

在Headers中向下滚动，找到 **Request Headers（请求标头）** 部分：

#### A. 找到CSRF Token
```
x-meego-csrf-token: EB0Lt4gu-nmqg-Cq8M-2pgo-Qy0DvtsKkqGC
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                    复制这串字符（每个人的都不一样）
```

#### B. 找到Cookie
```
Cookie: session=xxxxx; csrf_token=xxxxx; user_id=xxxxx; ...
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        复制整个Cookie值（很长的一串）
```

**注意**：Cookie可能很长，确保复制完整，从 `Cookie:` 后面的第一个字符开始，一直到这一行结束。

## 步骤6：创建配置文件

1. 打开记事本或任何文本编辑器
2. 创建以下内容（替换为您复制的值）：

```json
{
  "csrf_token": "这里粘贴您的x-meego-csrf-token值",
  "cookie": "这里粘贴您的完整Cookie字符串"
}
```

3. 保存文件为：`D:\code\WSJF\feishu-project-workflow\auth-credentials.json`

## 步骤7：运行自动配置

1. 打开文件资源管理器
2. 进入 `D:\code\WSJF\feishu-project-workflow` 文件夹
3. 双击运行 `install-and-run.bat`

---

## ❓ 常见问题

### Q: 找不到"新建字段"按钮？
**A:** 可能的位置：
- 页面右上角
- 表格上方的工具栏
- 可能是一个"+"图标
- 可能需要先选择左侧的"需求"类型

### Q: Network中没有看到field请求？
**A:**
- 确保勾选了"Preserve log"
- 点击"Clear"清空，然后重新创建字段
- 在Filter框中输入"field"过滤
- 查找状态码为200的POST请求

### Q: Cookie在哪里？
**A:**
- 在Request Headers部分（不是Response Headers）
- Cookie通常很长，可能需要横向滚动才能看全
- 双击Cookie那一行可以全选

### Q: CSRF Token找不到？
**A:**
- 寻找 `x-meego-csrf-token`（注意是小写）
- 在Request Headers部分
- 如果没有，可能需要重新登录

---

## 💡 提示

1. **凭证有效期**：获取的凭证通常只有2-4小时有效
2. **不要关闭浏览器**：在完成配置前保持登录状态
3. **测试字段**：创建成功后可以删除，不影响使用

如果还有疑问，可以截图开发者工具的Network面板，我来帮您识别需要的信息。