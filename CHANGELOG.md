# 更新日志 / Changelog

## [1.3.0] - 2025-01-20

### 🎨 UX/UI Improvements / 用户体验优化

#### 视觉一致性增强 / Visual Consistency Enhancement

**需求卡片4档蓝色映射**
- 实现10分制业务影响度到4档蓝色的视觉映射
  - 战略平台（10分）：极深蓝色渐变 `#1E40AF → #1E3A8A`
  - 撬动核心（8-9分）：深蓝色渐变 `#2563EB → #1D4ED8`
  - 明显（5-7分）：中蓝色渐变 `#60A5FA → #3B82F6`
  - 局部（1-4分）：浅蓝色渐变 `#DBEAFE → #BFDBFE`（深色文字）
- 优先显示强制DDL需求（红色渐变）
- 完全向后兼容旧的bv字段

**筛选框颜色图例**
- 业务影响度筛选下拉框添加实际颜色背景
- 使用方块符号(■)替代emoji，提升视觉清晰度
- 颜色与需求卡片保持完全一致
- 浅蓝色选项使用深色文字确保可读性

**评分说明书区间显示**
- 说明书中的业务影响度显示分值区间而非单个数字
  - 战略平台：10分档
  - 撬动核心：8-9分档
  - 明显：5-7分档
  - 局部：1-4分档
- 与筛选框描述保持完全一致

**评分标准文档优化**
- 为所有10个评分标准添加分档标注
  - 格式：【X-Y分档-档位名称】+ 原有描述
  - 清晰展示10分制如何映射到4档系统
  - 例如：`【8-9分档-撬动核心】关键流程严重受阻...`

### 🐛 Bug Fixes / 问题修复

**需求类型筛选健壮性增强**
- 修复"功能开发"筛选无法正常工作的BUG
- 处理type字段为空或包含空格的情况
- 默认值策略：type为空时默认为"功能开发"
- 增加`.trim()`处理避免空格导致的匹配失败

### 🔧 Technical Changes / 技术变更

**修改的代码位置**：

1. **src/components/RequirementCard.tsx**
   - Line 135-177: 重写 `getColor` 函数，支持10分制到4档映射
   - 新增4档蓝色渐变常量定义
   - 优化文字颜色自适应逻辑

2. **src/components/UnscheduledArea.tsx**
   - Line 129-131: 增强type字段筛选健壮性
   - Line 376-380: 添加业务影响度筛选框颜色图例

3. **src/components/HandbookModal.tsx**
   - Line 30-36: 添加分值区间映射配置
   - Line 84: 使用区间显示替代单个分值

4. **src/config/scoringStandards.ts**
   - 全文更新：所有shortDescription添加分档标注
   - 格式统一：【分档-档位】+ 描述

### ✅ Quality Assurance / 质量保证

- **TypeScript 编译**：✅ 无错误
- **HMR 热更新**：✅ 正常工作
- **向后兼容性**：✅ 完全兼容旧数据格式
- **用户验收测试**：✅ 通过
  - 筛选框功能验证OK，颜色有区分
  - 筛选功能正常工作
  - 说明书图例显示正确的数值区间

### 📊 Impact Analysis / 影响分析

**用户体验改进**：
- ✅ 视觉层次更清晰，4档蓝色深浅度明显可辨
- ✅ 筛选操作更直观，颜色图例降低认知成本
- ✅ 学习成本降低，说明书与界面保持一致
- ✅ 系统可用性提升，筛选BUG修复

**代码质量提升**：
- ✅ 类型安全：所有新代码都有完整的TypeScript类型
- ✅ 健壮性增强：处理边界情况（空值、空格）
- ✅ 可维护性：颜色映射集中管理，易于调整
- ✅ 文档完善：新增独立需求文档 `09-ux-visual-consistency.md`

---

## [1.1.0] - 2025-10-17

### 🎯 Major Improvements / 重大改进

#### 评分算法优化 / Scoring Algorithm Enhancement
- **8档工作量评分系统**：将工作量加分从4档扩展到8档，提供更细粒度的激励机制
  - ≤2天: +8分
  - 3-5天: +7分
  - 6-14天: +5分
  - 15-30天: +3分
  - 31-50天: +2分
  - 51-100天: +1分
  - 101-150天: 0分
  - >150天: 0分（建议切分）

- **原始分范围扩展**：从 3-26 扩展到 3-28，以支持新的工作量评分
- **展示分归一化**：保持 1-100 范围不变，基于新的原始分范围重新计算

#### 术语一致性改进 / Terminology Consistency
- **业务价值**：统一所有界面和说明书中的字段名称，从"价值"改为"业务价值"
- **迫切程度**：修复重复文字，从"迫切程度度"改为"迫切程度"
- **技术进展**：将说明书中的"就绪度（DoR）"更新为"技术进展"，与实际功能保持一致
  - 说明：只有"已评估工作量"或"已完成技术方案"的需求才能拖入迭代池排期
  - "未评估"状态的需求无法排期

### 🐛 Bug Fixes / 问题修复

- **下拉框文字遮挡修复**：增加业务域下拉框的右侧内边距（pr-8 → pr-10），避免长文本被下拉箭头遮挡
  - 影响：特别是"国际零售通用"等较长选项的显示

### 📝 Documentation Updates / 文档更新

- **评分说明书全面更新**：
  - 更新工作量评分说明，详细列出8档评分标准
  - 更新原始分范围说明（3-28）
  - 统一所有字段术语（业务价值、迫切程度、技术进展）
  - 更新术语表，移除DoR概念，增加技术进展说明

- **代码注释更新**：
  - 更新 `calculateScores` 函数的算法说明
  - 更新接口类型定义中的注释
  - 更新编辑弹窗中的实时预览计算逻辑

### 🔧 Technical Changes / 技术变更

**修改的代码位置**：

1. **src/wsjf-sprint-planner.tsx**
   - Line 77: 更新 Requirement 接口注释（rawScore 范围 3-28）
   - Line 115-130: 更新算法说明注释
   - Line 155-167: 重写 `getWorkloadScore` 函数（8档评分）
   - Line 606: HandbookModal - 字段名"业务价值"
   - Line 615, 721: HandbookModal - "迫切程度"（移除重复字）
   - Line 651: HandbookModal - "就绪度" → "技术进展"
   - Line 728: HandbookModal - 术语表更新
   - Line 926-942: EditRequirementModal - 更新实时预览计算逻辑
   - Line 986: 业务域下拉框 - 增加右侧padding（pr-10）
   - Line 1180: 工作量加分提示UI - 8档提示文本
   - Line 1938: UnscheduledArea - 筛选器标签"全部业务价值"

2. **package.json**
   - Line 3: 版本号更新 1.0.0 → 1.1.0

### ✅ Quality Assurance / 质量保证

- **TypeScript 编译**：✅ 无错误
- **生产构建**：✅ 成功（构建时间 6.62s）
- **包大小**：1,259.01 KB（gzip: 390.95 KB）
- **测试部署**：✅ 腾讯云部署成功

### 🚀 Migration Guide / 迁移指南

从 v1.0.0 升级到 v1.1.0 时：

1. **数据兼容性**：完全向下兼容，现有 localStorage 数据自动适配新评分算法
2. **分数重新计算**：由于工作量评分规则变化，所有需求的热度分会自动重新计算
3. **预期变化**：
   - 短工期需求（≤5天）的热度分会略有提升
   - 中长工期需求（15-100天）会有更细粒度的区分
   - 超长工期需求（>150天）保持不变

### 📊 Impact Analysis / 影响分析

**评分分布变化预测**：
- 2天以内的需求：+2分（6→8）
- 3-5天的需求：+1分（6→7）
- 6-14天的需求：+1分（4→5）
- 15-30天的需求：+1分（2→3）
- 其他区间：新增更细分档位

**用户体验改进**：
- ✅ 更强的小任务拆分激励
- ✅ 中等工作量任务有更清晰的区分度
- ✅ 术语更加准确，降低理解成本
- ✅ UI显示问题修复，提升可读性

---

## [1.0.0] - 2025-10-15

### Initial Release / 首次发布

- 完整的 WSJF 评分系统
- 拖拽式迭代排期
- 需求管理和筛选
- Excel 导入导出功能
- AI 智能映射（Gemini）
- 腾讯云 CloudBase 部署支持
- Vercel 部署支持

---

## 版本号说明 / Version Numbering

本项目遵循 [语义化版本 2.0.0](https://semver.org/lang/zh-CN/)

格式：`主版本号.次版本号.修订号`

- **主版本号**：做了不兼容的 API 修改
- **次版本号**：做了向下兼容的功能性新增
- **修订号**：做了向下兼容的问题修正
