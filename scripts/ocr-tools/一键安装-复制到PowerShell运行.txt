# DeepSeek-OCR 一键安装命令
# 复制以下所有内容到PowerShell（管理员模式）中运行

# ========================================
# 第1步：准备WSL2环境
# ========================================

# 检查WSL状态
wsl --list --verbose

# 如果Ubuntu未运行，启动它
wsl -d Ubuntu echo "Ubuntu started"

# ========================================
# 第2步：自动化安装（一行命令）
# ========================================

# 复制并运行以下命令（这会花费10-20分钟）
wsl -d Ubuntu bash -c 'set -e; export DEBIAN_FRONTEND=noninteractive; echo "[1/9] 更新系统..."; sudo apt-get update -qq; sudo apt-get upgrade -y -qq; echo "[2/9] 安装Python..."; sudo apt-get install -y software-properties-common; sudo add-apt-repository ppa:deadsnakes/ppa -y; sudo apt-get update -qq; sudo apt-get install -y python3.12 python3.12-venv python3.12-dev python3-pip; echo "[3/9] 安装工具..."; sudo apt-get install -y build-essential git wget poppler-utils; echo "[4/9] 创建虚拟环境..."; rm -rf ~/deepseek-env; python3.12 -m venv ~/deepseek-env; echo "[5/9] 激活环境..."; source ~/deepseek-env/bin/activate; echo "[6/9] 升级pip..."; pip install --upgrade pip; echo "[7/9] 安装PyTorch..."; pip install torch==2.6.0 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118; echo "[8/9] 安装vLLM..."; pip install vllm==0.8.5 pillow pdf2image transformers accelerate; echo "[9/9] 测试..."; python3 -c "import torch, vllm; print(f\"✓ PyTorch {torch.__version__}\"); print(f\"✓ CUDA: {torch.cuda.is_available()}\"); print(f\"✓ vLLM {vllm.__version__}\"); print(\"\\n✓✓✓ 安装成功！\")"; echo "完成！"'

# ========================================
# 第3步：验证安装
# ========================================

# 检查安装是否成功
wsl -d Ubuntu bash -c "source ~/deepseek-env/bin/activate && python3 -c 'import vllm; print(\"vLLM installed:\", vllm.__version__)'"

# ========================================
# 安装完成！
# ========================================

# 下一步：测试转换
# wsl -d Ubuntu bash -c "source ~/deepseek-env/bin/activate && python3 ~/.claude/skills/deepseek-ocr-to-md/scripts/convert_to_md.py --help"
