=======================================================================
  DeepSeek-OCR完整安装命令（可看到实时进度）
=======================================================================

请复制以下整个命令块到PowerShell中运行（一次性复制全部）：

-----------------------------------------------------------------------
开始复制
-----------------------------------------------------------------------

wsl -d Ubuntu bash -c '
set -e
export DEBIAN_FRONTEND=noninteractive

echo ""
echo "========================================"
echo "  DeepSeek-OCR 安装开始"
echo "========================================"
echo ""

echo "[1/8] 更新系统包..."
sudo apt-get update -qq
sudo apt-get upgrade -y -qq
echo "✓ 系统更新完成"

echo ""
echo "[2/8] 安装Python 3.12..."
sudo apt-get install -y software-properties-common
sudo add-apt-repository ppa:deadsnakes/ppa -y
sudo apt-get update -qq
sudo apt-get install -y python3.12 python3.12-venv python3.12-dev python3-pip
echo "✓ Python 3.12 安装完成"
python3.12 --version

echo ""
echo "[3/8] 安装基础工具..."
sudo apt-get install -y build-essential git wget poppler-utils
echo "✓ 基础工具安装完成"

echo ""
echo "[4/8] 创建虚拟环境..."
rm -rf ~/deepseek-env
python3.12 -m venv ~/deepseek-env
echo "✓ 虚拟环境创建完成"
ls -la ~/deepseek-env/bin/python3

echo ""
echo "[5/8] 激活环境并升级pip..."
source ~/deepseek-env/bin/activate
pip install --upgrade pip
echo "✓ pip升级完成"
pip --version

echo ""
echo "[6/8] 安装PyTorch (这需要5-10分钟)..."
pip install torch==2.6.0 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
echo "✓ PyTorch安装完成"
python3 -c "import torch; print(f\"PyTorch version: {torch.__version__}\")"

echo ""
echo "[7/8] 安装vLLM (这需要3-5分钟)..."
pip install vllm==0.8.5
echo "✓ vLLM安装完成"
python3 -c "import vllm; print(f\"vLLM version: {vllm.__version__}\")"

echo ""
echo "[8/8] 安装其他依赖..."
pip install pillow pdf2image transformers accelerate
echo "✓ 其他依赖安装完成"

echo ""
echo "========================================"
echo "  测试安装结果"
echo "========================================"
python3 << PYEOF
import torch
import vllm
from PIL import Image

print(f"✓ PyTorch: {torch.__version__}")
print(f"✓ CUDA available: {torch.cuda.is_available()}")
if torch.cuda.is_available():
    print(f"✓ CUDA version: {torch.version.cuda}")
    print(f"✓ GPU: {torch.cuda.get_device_name(0)}")
else:
    print("⚠ CUDA not available (will use CPU - very slow)")

print(f"✓ vLLM: {vllm.__version__}")
print(f"✓ Pillow installed")

print("")
print("✓✓✓ 全部安装成功！✓✓✓")
PYEOF

echo ""
echo "创建快捷命令..."
cat > ~/.ocr_aliases << ALIASEOF
alias ocr-activate="source ~/deepseek-env/bin/activate"
alias ocr-test="source ~/deepseek-env/bin/activate && python3 -c \"import vllm; print(\\\"vLLM OK\\\")\""
ALIASEOF

if ! grep -q ".ocr_aliases" ~/.bashrc 2>/dev/null; then
    echo "source ~/.ocr_aliases" >> ~/.bashrc
fi

echo ""
echo "========================================"
echo "  安装完成！"
echo "========================================"
echo ""
echo "下次使用前激活环境:"
echo "  source ~/deepseek-env/bin/activate"
echo ""
echo "或使用快捷命令:"
echo "  ocr-activate"
echo ""
'

-----------------------------------------------------------------------
结束复制
-----------------------------------------------------------------------

=======================================================================
  预计时间
=======================================================================

总时间: 约15-25分钟

各步骤耗时:
  [1-3] 系统和工具: 2-3分钟
  [4-5] Python环境: 1分钟
  [6] PyTorch: 5-10分钟 ← 最耗时
  [7] vLLM: 3-5分钟
  [8] 其他依赖: 1-2分钟

=======================================================================
  安装完成后
=======================================================================

验证安装:

  wsl -d Ubuntu bash -c "source ~/deepseek-env/bin/activate && python3 -c 'import vllm; print(\"✓ OK\")'"

测试转换:

  wsl -d Ubuntu bash -c "source ~/deepseek-env/bin/activate && python3 ~/.claude/skills/deepseek-ocr-to-md/scripts/convert_to_md.py --help"

=======================================================================

说明:
- 这个命令会显示实时进度
- 您可以看到每一步的完成状态
- 如果某步失败，会立即停止并显示错误
- 成功后会显示"✓✓✓ 全部安装成功！"

复制上面的完整命令块到PowerShell运行即可！

=======================================================================
