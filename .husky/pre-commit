#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” è¿è¡Œæ–‡ä»¶å¤§å°æ£€æŸ¥..."

npm run check-file-size

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ æäº¤è¢«æ‹’ç»ï¼šå­˜åœ¨è¶…è¿‡ 500 è¡Œçš„æ–‡ä»¶"
  echo ""
  echo "ğŸ“‹ è§£å†³æ–¹æ¡ˆï¼š"
  echo "   1. è¿è¡Œ 'npm run check-file-size' æŸ¥çœ‹é—®é¢˜æ–‡ä»¶"
  echo "   2. å°†è¶…æ ‡æ–‡ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªå°æ–‡ä»¶"
  echo "   3. ä½¿ç”¨ Hook æå–ä¸šåŠ¡é€»è¾‘"
  echo "   4. ä½¿ç”¨å­ç»„ä»¶æ‹†åˆ† UI"
  echo ""
  echo "ğŸ’¡ å‚è€ƒæ–‡æ¡£ï¼š"
  echo "   - docs/architecture-guide.md"
  echo "   - ai-templates/REFACTORING_LESSONS_LEARNED.md"
  echo "   - ai-templates/FILE_SIZE_ENFORCEMENT.md"
  echo ""
  exit 1
fi

echo "âœ… æ–‡ä»¶å¤§å°æ£€æŸ¥é€šè¿‡"

echo ""
echo "ğŸ§ª è¿è¡Œå•å…ƒæµ‹è¯•..."

npm run test:run

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ æäº¤è¢«æ‹’ç»ï¼šæµ‹è¯•æœªé€šè¿‡"
  echo ""
  echo "ğŸ“‹ è§£å†³æ–¹æ¡ˆï¼š"
  echo "   1. è¿è¡Œ 'npm run test' æŸ¥çœ‹å¤±è´¥çš„æµ‹è¯•"
  echo "   2. ä¿®å¤å¤±è´¥çš„æµ‹è¯•"
  echo "   3. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡åå†æäº¤"
  echo ""
  echo "ğŸ’¡ å¦‚éœ€è·³è¿‡æµ‹è¯•ï¼ˆä¸æ¨èï¼‰ï¼š"
  echo "   git commit --no-verify -m \"message\""
  echo ""
  echo "ğŸ“– å‚è€ƒæ–‡æ¡£ï¼š"
  echo "   - docs/standards/test-driven-development.md"
  echo ""
  exit 1
fi

echo "âœ… æµ‹è¯•æ£€æŸ¥é€šè¿‡"
